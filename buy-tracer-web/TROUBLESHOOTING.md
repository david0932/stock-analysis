# 故障排除指南

## 常見問題

### 1. 上櫃股票無法查詢（已修正）

**症狀:**
- 輸入上櫃股票代號（如 3363）時顯示錯誤
- 錯誤訊息：「此為上櫃股票，目前系統僅支援上市股票」

**原因:**
本系統目前僅支援**台灣上市股票（TWSE）**，暫不支援上櫃股票（TPEx/OTC）。

**解決方案:**
✅ **系統已新增股票代號驗證功能**
- 輸入股票代號後，系統會自動檢查是否為有效的上市股票
- 若為上櫃股票，會明確提示並建議使用上市股票
- 若代號不存在，會提示確認代號是否正確

**如何區分上市與上櫃:**
- **上市股票（TWSE）** - 可查詢 ✅
  - 例如：2330 台積電、2317 鴻海、2454 聯發科
  - 通常為大型企業

- **上櫃股票（TPEx）** - 暫不支援 ❌
  - 例如：3363 上詮、5274 信驊、6510 精測
  - 通常為中小型企業

### 2. 股票代號不存在

**症狀:**
- 錯誤訊息：「股票代號 XXXX 不存在於台灣上市或上櫃市場」

**可能原因:**
1. **代號輸入錯誤** - 請確認代號是否正確
2. **股票已下市** - 該股票可能已經下市
3. **代號格式錯誤** - 應為 4-6 位純數字

**解決方案:**
- 確認股票代號格式正確（應為 4-6 位數字）
- 前往 [Yahoo 財經](https://tw.stock.yahoo.com/) 或 [台灣證券交易所](https://www.twse.com.tw/) 確認代號
- 嘗試其他常見上市股票，例如:
  - 2330 (台積電)
  - 2454 (聯發科)
  - 2317 (鴻海)
  - 2881 (富邦金)
  - 2882 (國泰金)
  - 2412 (中華電)

### 2. 數據日期範圍問題

**已修正:**
- 系統現在只會獲取到**前一個交易日**的數據
- 不會嘗試獲取今日或未來日期的數據

**後端輸出示例:**
```
首次下載數據: 2330
  > 數據獲取範圍: 2024-01-01 ~ 2025-12-08  ← 到昨天為止
  > 獲取 2024 年 1 月數據...
  ...
  > 獲取 2025 年 12 月數據...  ← 當前月份
  > 獲取到 XXX 筆原始數據
```

### 3. 快取相關問題

**清除快取:**
如果遇到數據異常，可以嘗試清除快取:
1. 在分析頁面點擊「清除快取」按鈕
2. 或手動刪除 `.cache/` 目錄中的 JSON 檔案

**強制更新:**
點擊「更新數據」按鈕可強制更新到最新的交易日數據

## 錯誤訊息說明

### TICKER_NOT_FOUND
**錯誤代碼:** `TICKER_NOT_FOUND`
**HTTP 狀態:** 404

**完整訊息:**
```
無法獲取股票 XXXX 的數據。
可能原因: 股票代號不存在、已下市，或 twstock 資料庫中沒有此股票數據。
請確認股票代號是否正確。
```

**處理方式:**
1. 檢查股票代號是否輸入正確
2. 嘗試其他股票代號
3. 確認該股票是否仍在上市櫃交易

### INSUFFICIENT_DATA
**錯誤代碼:** `INSUFFICIENT_DATA`
**HTTP 狀態:** 400

**訊息:**
```
數據不足，需要至少 60 個交易日進行技術分析
當前僅有 XX 個交易日
```

**處理方式:**
- 調整起始日期 (`start_date`) 以包含更多歷史數據
- 確保股票有足夠的交易歷史

### INVALID_TICKER_FORMAT
**錯誤代碼:** `INVALID_TICKER_FORMAT`
**HTTP 狀態:** 400

**訊息:**
```
股票代號格式錯誤（應為 4-6 位數字）
```

**處理方式:**
- 確保輸入的是純數字
- 股票代號長度為 4-6 位數字
- 不要包含英文字母或特殊符號

## 資料來源限制

### twstock 限制
本系統使用 `twstock` 套件作為資料來源，該套件有以下限制:

1. **資料覆蓋範圍**
   - 不是所有上市櫃股票都有完整資料
   - 部分股票可能完全無資料

2. **資料更新頻率**
   - 資料可能有延遲
   - 通常更新至前一個交易日

3. **可靠性**
   - 主要股票（如台積電、鴻海等）資料較完整可靠
   - 冷門股票或新上市股票可能資料不足

### 建議使用的股票範例

**科技股:**
- 2330 台積電
- 2454 聯發科
- 2408 南亞科
- 3034 聯詠

**金融股:**
- 2881 富邦金
- 2882 國泰金
- 2891 中信金

**傳統產業:**
- 2317 鴻海
- 2382 廣達
- 1301 台塑

## 技術支援

如果遇到其他問題，請檢查:
1. **後端控制台輸出** - 查看詳細的錯誤訊息
2. **瀏覽器開發者工具** - 檢查網路請求和 JavaScript 錯誤
3. **快取狀態** - 嘗試清除快取後重試

## 更新日誌

### 2025-12-09 (v2)
- ✅ **新增股票代號驗證功能**
  - 自動檢查輸入的股票代號是否為有效的上市股票
  - 若為上櫃股票，明確提示系統僅支援上市股票，並提供建議股票清單
  - 若代號不存在，提示用戶確認代號或參考其他來源

### 2025-12-09 (v1)
- ✅ 修正資料獲取範圍，現在只會獲取到前一個交易日
- ✅ 改善錯誤訊息，提供更詳細的故障原因說明
- ✅ 前端錯誤訊息支援多行顯示
- ✅ 更新首頁範例股票代號，移除不可用的股票
