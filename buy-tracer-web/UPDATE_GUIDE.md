# Docker æ›´æ–°æŒ‡å—

æœ¬æ–‡æª”èªªæ˜å¦‚ä½•æ›´æ–°é ç«¯ Docker éƒ¨ç½²çš„è‚¡ç¥¨åˆ†æ Web æ‡‰ç”¨ã€‚

## ğŸ“‹ æ›´æ–°è…³æœ¬èªªæ˜

å°ˆæ¡ˆæä¾›å…©å€‹æ›´æ–°è…³æœ¬ï¼š

### 1. `quick-update.sh` - å¿«é€Ÿæ›´æ–°ï¼ˆæ¨è–¦ï¼‰

**ç”¨é€”**: ä¸€éµå¿«é€Ÿæ›´æ–°ï¼Œé©åˆæ—¥å¸¸ä½¿ç”¨

**åŠŸèƒ½**:
- å¾ Git æ‹‰å–æœ€æ–°ä»£ç¢¼
- é‡æ–°å•Ÿå‹• Docker å®¹å™¨
- è‡ªå‹•æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹

**ä½¿ç”¨æ–¹æ³•**:
```bash
./quick-update.sh
```

**ç‰¹é»**:
- ğŸš€ å¿«é€Ÿç°¡å–®
- âœ… è‡ªå‹•åŒ–æµç¨‹
- ğŸ“ é¡¯ç¤ºæœ€æ–°æäº¤è¨Šæ¯

---

### 2. `update.sh` - å®Œæ•´æ›´æ–°è…³æœ¬

**ç”¨é€”**: åŠŸèƒ½å®Œæ•´çš„æ›´æ–°è…³æœ¬ï¼Œæ”¯æ´å¤šç¨®é¸é …

**åŠŸèƒ½**:
- è‡ªå‹•å‚™ä»½æ‡‰ç”¨è³‡æ–™
- å¾ Git æ‹‰å–æœ€æ–°ä»£ç¢¼
- é¡¯ç¤ºå³å°‡æ›´æ–°çš„æäº¤è¨˜éŒ„
- é‡æ–°æ§‹å»ºä¸¦å•Ÿå‹•å®¹å™¨
- ç­‰å¾…æœå‹™å°±ç·’
- æ¸…ç†èˆŠ Docker æ˜ åƒ
- é¡¯ç¤ºè©³ç´°ç‹€æ…‹è³‡è¨Š

**åŸºæœ¬ä½¿ç”¨**:
```bash
# æ¨™æº–æ›´æ–°ï¼ˆæ¨è–¦ï¼‰
./update.sh

# ä½¿ç”¨ç°¡å–®æ¨¡å¼éƒ¨ç½²
./update.sh --simple

# å¼·åˆ¶é‡æ–°æ§‹å»ºæ˜ åƒ
./update.sh --force

# åƒ…é‡å•Ÿå®¹å™¨ï¼ˆä¸æ‹‰å–ä»£ç¢¼ï¼‰
./update.sh --skip-git-pull

# è·³éè³‡æ–™å‚™ä»½
./update.sh --skip-backup
```

**é¸é …èªªæ˜**:
```
-h, --help              é¡¯ç¤ºå¹«åŠ©è¨Šæ¯
-s, --simple            ä½¿ç”¨ç°¡å–®æ¨¡å¼éƒ¨ç½²ï¼ˆåƒ…æ‡‰ç”¨ï¼Œç«¯å£ 5000ï¼‰
-f, --force             å¼·åˆ¶é‡æ–°æ§‹å»ºæ˜ åƒ
--skip-backup           è·³éè³‡æ–™å‚™ä»½
--skip-git-pull         è·³é Git æ‹‰å–ï¼ˆåƒ…é‡å•Ÿå®¹å™¨ï¼‰
```

**ä½¿ç”¨ç¯„ä¾‹**:
```bash
# æŸ¥çœ‹å¹«åŠ©
./update.sh --help

# å¿«é€Ÿé‡å•Ÿå®¹å™¨ï¼ˆä¸æ›´æ–°ä»£ç¢¼ï¼‰
./update.sh --skip-git-pull

# å®Œå…¨é‡å»ºï¼ˆæ¸…é™¤å¿«å–ï¼‰
./update.sh --force

# ç°¡å–®æ¨¡å¼æ›´æ–°
./update.sh --simple
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ­¥é©Ÿ 1: SSH é€£æ¥åˆ°é ç«¯ä¼ºæœå™¨

```bash
ssh user@your-server-ip
```

### æ­¥é©Ÿ 2: é€²å…¥å°ˆæ¡ˆç›®éŒ„

```bash
cd /path/to/buy-tracer-web
```

### æ­¥é©Ÿ 3: åŸ·è¡Œæ›´æ–°

```bash
# æ–¹å¼ 1: ä½¿ç”¨å¿«é€Ÿæ›´æ–°ï¼ˆæ¨è–¦ï¼‰
./quick-update.sh

# æ–¹å¼ 2: ä½¿ç”¨å®Œæ•´æ›´æ–°
./update.sh
```

### æ­¥é©Ÿ 4: é©—è­‰æ›´æ–°

```bash
# æª¢æŸ¥å®¹å™¨ç‹€æ…‹
sudo docker compose ps

# æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
sudo docker compose logs -f app

# æ¸¬è©¦ API å¥åº·ç‹€æ…‹
curl http://localhost:5000/api/health
```

---

## ğŸ“¦ æ›´æ–°æµç¨‹è©³è§£

### å®Œæ•´æ›´æ–°æµç¨‹ï¼ˆ`update.sh`ï¼‰

1. **ç’°å¢ƒæª¢æŸ¥**
   - æª¢æŸ¥ Docker å’Œ Docker Compose æ˜¯å¦å¯ç”¨
   - é¡¯ç¤ºç•¶å‰å®¹å™¨é‹è¡Œç‹€æ…‹

2. **è³‡æ–™å‚™ä»½**
   - å‚™ä»½ Docker volume è³‡æ–™åˆ° `backups/` ç›®éŒ„
   - ä¿ç•™æœ€è¿‘ 5 å€‹å‚™ä»½

3. **ä»£ç¢¼æ›´æ–°**
   - æª¢æŸ¥ç•¶å‰ Git åˆ†æ”¯å’Œç‰ˆæœ¬
   - é¡¯ç¤ºå³å°‡æ›´æ–°çš„æäº¤è¨˜éŒ„
   - å¾é ç«¯æ‹‰å–æœ€æ–°ä»£ç¢¼

4. **å®¹å™¨é‡å»º**
   - åœæ­¢ä¸¦ç§»é™¤ç¾æœ‰å®¹å™¨
   - é‡æ–°æ§‹å»º Docker æ˜ åƒ
   - å•Ÿå‹•æ–°å®¹å™¨

5. **å¥åº·æª¢æŸ¥**
   - ç­‰å¾…æœå‹™å°±ç·’ï¼ˆæœ€å¤š 60 ç§’ï¼‰
   - æ¸¬è©¦ API å¥åº·ç«¯é»

6. **æ¸…ç†èˆ‡é¡¯ç¤º**
   - æ¸…ç†æœªä½¿ç”¨çš„ Docker æ˜ åƒ
   - é¡¯ç¤ºæ›´æ–°ç‹€æ…‹å’Œè¨ªå•è³‡è¨Š

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹å®¹å™¨ç‹€æ…‹
```bash
sudo docker compose ps
```

### æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥èªŒ
sudo docker compose logs

# æŒçºŒç›£æ§æ—¥èªŒ
sudo docker compose logs -f

# åªçœ‹æœ€è¿‘ 50 è¡Œ
sudo docker compose logs --tail=50

# åªçœ‹æ‡‰ç”¨å®¹å™¨æ—¥èªŒ
sudo docker compose logs -f app
```

### é‡å•Ÿæœå‹™
```bash
# é‡å•Ÿæ‰€æœ‰æœå‹™
sudo docker compose restart

# åªé‡å•Ÿæ‡‰ç”¨å®¹å™¨
sudo docker compose restart app
```

### åœæ­¢æœå‹™
```bash
# åœæ­¢ä½†ä¸åˆªé™¤å®¹å™¨
sudo docker compose stop

# åœæ­¢ä¸¦åˆªé™¤å®¹å™¨
sudo docker compose down
```

### æ‰‹å‹•æ›´æ–°ï¼ˆä¸ä½¿ç”¨è…³æœ¬ï¼‰
```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç¢¼
git pull origin master

# 2. é‡æ–°æ§‹å»ºä¸¦å•Ÿå‹•
sudo docker compose down
sudo docker compose up -d --build

# 3. æŸ¥çœ‹æ—¥èªŒ
sudo docker compose logs -f
```

---

## ğŸ” æ•…éšœæ’é™¤

### å•é¡Œ 1: æ›´æ–°å¾Œæœå‹™ç„¡æ³•å•Ÿå‹•

**è§£æ±ºæ–¹æ³•**:
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥èªŒ
sudo docker compose logs app

# æª¢æŸ¥å®¹å™¨ç‹€æ…‹
sudo docker compose ps

# å˜—è©¦é‡å•Ÿ
sudo docker compose restart
```

### å•é¡Œ 2: Git æ‹‰å–å¤±æ•—

**åŸå› **: æœ¬åœ°æœ‰æœªæäº¤çš„æ›´æ”¹

**è§£æ±ºæ–¹æ³•**:
```bash
# æŸ¥çœ‹æœªæäº¤çš„æ›´æ”¹
git status

# æš«å­˜æ›´æ”¹
git stash

# æ‹‰å–æœ€æ–°ä»£ç¢¼
git pull origin master

# æ¢å¾©æš«å­˜çš„æ›´æ”¹ï¼ˆå¦‚éœ€è¦ï¼‰
git stash pop
```

### å•é¡Œ 3: Docker æ¬Šé™éŒ¯èª¤

**éŒ¯èª¤è¨Šæ¯**: `permission denied while trying to connect to the Docker daemon`

**è§£æ±ºæ–¹æ³•**:
```bash
# ç¢ºèªä½¿ç”¨ sudo
sudo docker compose up -d

# æˆ–å°‡ç”¨æˆ¶åŠ å…¥ docker ç¾¤çµ„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å…¥ä½¿æ¬Šé™ç”Ÿæ•ˆ
```

### å•é¡Œ 4: å®¹å™¨å•Ÿå‹•ä½†ç„¡æ³•è¨ªå•

**è§£æ±ºæ–¹æ³•**:
```bash
# æª¢æŸ¥å®¹å™¨æ˜¯å¦çœŸçš„åœ¨é‹è¡Œ
sudo docker compose ps

# æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo netstat -tulpn | grep :5000
sudo netstat -tulpn | grep :80

# æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
sudo ufw status
```

### å•é¡Œ 5: ç£ç¢Ÿç©ºé–“ä¸è¶³

**è§£æ±ºæ–¹æ³•**:
```bash
# æ¸…ç†æœªä½¿ç”¨çš„ Docker è³‡æº
sudo docker system prune -a

# æŸ¥çœ‹ç£ç¢Ÿä½¿ç”¨æƒ…æ³
df -h

# åˆªé™¤èˆŠå‚™ä»½
rm -rf backups/backup_*
```

---

## ğŸ“Š è³‡æ–™å‚™ä»½èˆ‡æ¢å¾©

### æ‰‹å‹•å‚™ä»½

```bash
# å‚™ä»½æ‡‰ç”¨è³‡æ–™
sudo docker run --rm \
    -v buy-tracer-web_app-data:/data \
    -v $(pwd)/backup:/backup \
    alpine tar czf /backup/app-data-$(date +%Y%m%d).tar.gz -C /data .
```

### æ¢å¾©å‚™ä»½

```bash
# åœæ­¢å®¹å™¨
sudo docker compose down

# æ¢å¾©è³‡æ–™
sudo docker run --rm \
    -v buy-tracer-web_app-data:/data \
    -v $(pwd)/backup:/backup \
    alpine tar xzf /backup/app-data-20250101.tar.gz -C /data

# é‡å•Ÿå®¹å™¨
sudo docker compose up -d
```

---

## ğŸ”„ å›æ»¾åˆ°å…ˆå‰ç‰ˆæœ¬

å¦‚æœæ›´æ–°å¾Œå‡ºç¾å•é¡Œï¼Œå¯ä»¥å›æ»¾åˆ°å…ˆå‰ç‰ˆæœ¬ï¼š

```bash
# 1. æŸ¥çœ‹ Git æ­·å²
git log --oneline -10

# 2. å›æ»¾åˆ°ç‰¹å®šæäº¤
git reset --hard <commit-hash>

# 3. æ¢å¾©è³‡æ–™å‚™ä»½ï¼ˆå¦‚éœ€è¦ï¼‰
# åƒè¦‹ä¸Šæ–¹ã€Œæ¢å¾©å‚™ä»½ã€èªªæ˜

# 4. é‡æ–°éƒ¨ç½²
sudo docker compose down
sudo docker compose up -d --build
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **æ›´æ–°å‰ç¢ºèª**
   - ç¢ºä¿å·²å‚™ä»½é‡è¦è³‡æ–™
   - é¸æ“‡ä½æµé‡æ™‚æ®µé€²è¡Œæ›´æ–°
   - é€šçŸ¥ç”¨æˆ¶å¯èƒ½çš„çŸ­æš«ä¸­æ–·

2. **æ¬Šé™è¦æ±‚**
   - æ‰€æœ‰ Docker å‘½ä»¤éœ€è¦ `sudo` æ¬Šé™
   - ç¢ºä¿æœ‰ Git å€‰åº«çš„è®€å–æ¬Šé™

3. **ç¶²è·¯è¦æ±‚**
   - éœ€è¦ç©©å®šçš„ç¶²è·¯é€£æ¥
   - èƒ½å¤ è¨ªå• GitHub/Git ä¼ºæœå™¨
   - èƒ½å¤ æ‹‰å– Docker æ˜ åƒ

4. **ç£ç¢Ÿç©ºé–“**
   - ç¢ºä¿æœ‰è¶³å¤ ç©ºé–“å­˜å„²æ–°æ˜ åƒ
   - å®šæœŸæ¸…ç†èˆŠå‚™ä»½å’Œæœªä½¿ç”¨çš„æ˜ åƒ

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [éƒ¨ç½²æŒ‡å—](05-éƒ¨ç½²èˆ‡ä½¿ç”¨èªªæ˜.md)
- [æ•…éšœæ’é™¤](TROUBLESHOOTING.md)
- [Docker Compose é…ç½®](docker-compose.yml)
- [SSL è¨­å®š](SSL-SETUP.md)

---

## ğŸ†˜ ç²å–å¹«åŠ©

å¦‚é‡åˆ°å•é¡Œï¼Œè«‹ï¼š

1. æŸ¥çœ‹ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. æª¢æŸ¥å®¹å™¨æ—¥èªŒï¼š`sudo docker compose logs`
3. æŸ¥çœ‹ GitHub Issues
4. è¯ç¹«ç³»çµ±ç®¡ç†å“¡

---

**æœ€å¾Œæ›´æ–°**: 2025-12-26
